@model ClubInfluApp.ViewModels.GestionarUsuarioInfluencerViewModel

@{
	ViewData["Title"] = "Detalles del Influencer";
}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container mt-5">
	<h2 style="color: white;">Detalles del Influencer</h2>
	<table class="table table-bordered" style="background-color: white; color: black;">
		<tr>
			<th>Correo</th>
			<td>@Model.correo</td>
		</tr>
		<tr>
			<th>Nombre</th>
			<td>@Model.nombre</td>
		</tr>
		<tr>
			<th>Numero de Contacto</th>
			<td>@Model.numerocontacto</td>
		</tr>
		<tr>
			<th>Estado Usuario</th>
			<td>
				<select class="form-control" name="estadoUsuario" id="estadoUsuario" onchange="this.form.submit()">
					@foreach (var estado in Model.EstadoUsuarios)
					{
						<option value="@estado.IdEstadoUsuario" selected="@(estado.EstadoUsuario == Model.estadousuario ? "selected" : null)">
							@estado.EstadoUsuario
						</option>
					}
				</select>
			</td>
		</tr>
		<tr>
			<th>Genero</th>
			<td>@Model.genero</td>
		</tr>
		<tr>
			<th>Ciudad Principal</th>
			<td>@Model.ciudadprincipal</td>
		</tr>
		<tr>
			<th>Pais Ciudad Principal</th>
			<td>@Model.paisciudadprincipal</td>
		</tr>
		<tr>
			<th>Ciudad Secundaria</th>
			<td>@Model.ciudadsecundaria</td>
		</tr>
		<tr>
			<th>Pais Ciudad Secundaria</th>
			<td>@Model.paisciudadsecundaria</td>
		</tr>
		<tr>
			<th>Fecha Nacimiento</th>
			<td>@Model.fechaNacimiento</td>
		</tr>
		<tr>
			<th>Fecha Creacion</th>
			<td>@Model.usuariofechacreacion</td>
		</tr>
		<tr>
			<th>Fecha Actualizacion</th>
			<td>@Model.usuariofechaactualizacion</td>
		</tr>
	</table>


	<h3 class="mt-4" style="color: white;">Redes Sociales</h3>
	@if (Model.RedesSociales.Any())
	{
		<table class="table table-bordered" style="background-color: white; color: black;">
			<thead class="thead-dark">
				<tr>
					<th>Red Social</th>
					<th>Número de Seguidores</th>
					<th>Fecha de Creación</th>
					<th>Última Actualización</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var red in Model.RedesSociales)
				{
					<tr>
						<td>@red.redsocial</td>
						<td>@red.numeroseguidores</td>
						<td>@red.redfechacreacion.ToString("dd/MM/yyyy HH:mm")</td>
						<td>@red.redfechaactualizacion.ToString("dd/MM/yyyy HH:mm")</td>
					</tr>
				}
			</tbody>
		</table>
	}
	else
	{
		<p>No hay redes sociales registradas.</p>
	}

	<div class="mt-4">
		<a href="@Url.Action("ListarUsuariosInfluencer", "UsuarioInfluencer")" class="btn btn-secondary">Volver</a>
		<button id="showAlert" class="btn btn-success" onclick="aprobarSolicitud()">Actualizar Estado Influencer</button>
	</div>
</div>

<script>
	let estadoInicial = document.getElementById("estadoUsuario").value;
	document.getElementById("showAlert").addEventListener("click", function () {
		Swal.fire({
			title: "¿Quieres guardar los cambios?",
			showDenyButton: true,
			showCancelButton: true,
			confirmButtonText: "Guardar",
			denyButtonText: "No guardar"
		}).then((result) => {
			if (result.isConfirmed) {
				let estadoSeleccionado = document.getElementById("estadoUsuario").value;
				let idUsuarioInfluencer = @Html.Raw(Json.Serialize(Model.idUsuarioInfluencer));
				  if (estadoSeleccionado !== estadoInicial) {

			$.ajax({
				url: '@Url.Action("ActualizarEstadoUsuarioInfluencer", "UsuarioInfluencer")',
				type: "PUT",
				data: {
					idUsuarioInfluencer: idUsuarioInfluencer,
					idEstadoUsuarioInfluencer: estadoSeleccionado
				},
				success: function (response) {
					Swal.fire(response.mensaje, "", "info");
				},
				error: function (xhr, status, error) {
					console.error("Error al actualizar el estado:", xhr.responseText);
					Swal.fire("Hubo un error", "", "info");
				}
			});

				 } else {
					Swal.fire("NO SE HA CAMBIADO EL ESTADO DE USUARIO", "", "info");
				 }
			} else if (result.isDenied) {
				Swal.fire("Los cambios no se guardaron", "", "info");
			}
		});
	});
</script>

